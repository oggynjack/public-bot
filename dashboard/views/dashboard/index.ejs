<%- include('../layouts/header', { title: title || 'Dashboard' }) %>

<style>
/* Animated Colorful Background */
.animated-bg {
    background: linear-gradient(-45deg, #ee7752, #e73c7e, #23a6d5, #23d5ab, #ff6b6b, #4ecdc4, #45b7d1, #96ceb4, #ffeaa7, #fd79a8, #667eea, #764ba2);
    background-size: 1000% 1000%;
    animation: gradientShift 12s ease infinite;
    min-height: 100vh;
}

@keyframes gradientShift {
    0% {
        background-position: 0% 50%;
    }
    50% {
        background-position: 100% 50%;
    }
    100% {
        background-position: 0% 50%;
    }
}

/* Glass Effect Cards */
.glass-card {
    background: rgba(255, 255, 255, 0.1);
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255, 255, 255, 0.2);
    border-radius: 20px;
    box-shadow: 0 25px 45px rgba(0, 0, 0, 0.1);
    transition: all 0.3s ease;
}

.glass-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 35px 60px rgba(0, 0, 0, 0.2);
}

/* Premium Text Gradient */
.premium-text {
    background: linear-gradient(45deg, #ffffff 0%, #f0f9ff 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    font-weight: 800;
}
</style>

<div class="min-h-screen animated-bg py-8">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 relative z-10">
        <!-- Welcome Header -->
        <div class="glass-card p-8 mb-8">
            <div class="flex items-center justify-between">
                <div>
                    <h1 class="text-3xl md:text-4xl font-black text-white mb-4">
                        Welcome back, <span class="premium-text"><%= user.username %></span>! ðŸŽµ
                    </h1>
                    <p class="text-white/80 text-lg font-medium">
                        <% if (user.premiumPlus) { %>
                            Your PremiumPlus subscription is active until 
                            <span class="font-bold text-white"><%= new Date(user.premiumTo).toLocaleDateString() %></span>
                        <% } else { %>
                            Ready to get started with PremiumPlus? Check out our plans!
                        <% } %>
                    </p>
                </div>
                
                <% if (user.avatar) { %>
                    <img src="https://cdn.discordapp.com/avatars/<%= user.id %>/<%= user.avatar %>.png?size=80" 
                         alt="<%= user.username %>" 
                         class="w-20 h-20 rounded-full border-4 border-white/30 shadow-xl">
                <% } else { %>
                    <div class="w-20 h-20 bg-white/20 rounded-full flex items-center justify-center border-4 border-white/30 shadow-xl">
                        <i class="fas fa-user text-white text-2xl"></i>
                    </div>
                <% } %>
            </div>
        </div>

        <% if (!user.premiumPlus) { %>
            <!-- Premium Upgrade Banner -->
            <div class="glass-card p-8 mb-8 border-2 border-white/30">
                <div class="flex items-center justify-between">
                    <div>
                        <h2 class="text-2xl font-bold text-white mb-4">ðŸš€ <span class="premium-text">Upgrade to PremiumPlus</span></h2>
                        <p class="text-white/80 text-lg font-medium">Get your own music bot with premium features, 24/7 hosting, and complete customization!</p>
                    </div>
                    <a href="/dashboard/plans" class="bg-white/20 text-white px-8 py-4 rounded-xl font-bold hover:bg-white/30 transition-all duration-300 shadow-lg hover:shadow-xl transform hover:scale-105">
                        View Plans
                    </a>
                </div>
            </div>
        <% } else { %>
            <!-- Bot Status Cards -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                <!-- Bot Status -->
                <div class="bg-gray-800 rounded-lg p-6 border border-gray-700">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-lg font-semibold text-white">Bot Status</h3>
                        <div class="w-3 h-3 rounded-full <%= botStatus?.status === 'online' ? 'bg-green-400' : botStatus?.status === 'stopping' || botStatus?.status === 'restarting' ? 'bg-yellow-400' : 'bg-red-400' %>"></div>
                    </div>
                    <div class="text-2xl font-bold <%= botStatus?.status === 'online' ? 'text-green-400' : botStatus?.status === 'stopping' || botStatus?.status === 'restarting' ? 'text-yellow-400' : 'text-red-400' %>">
                        <%= botStatus?.status === 'online' ? 'Online' : botStatus?.status === 'stopped' ? 'Offline' : botStatus?.status || 'Unknown' %>
                    </div>
                    <p class="text-gray-400 text-sm">
                        <% if (botStatus?.status === 'online' && botStatus?.uptime) { %>
                            Uptime: <%= Math.floor(botStatus.uptime / 86400000) %>d <%= Math.floor((botStatus.uptime % 86400000) / 3600000) %>h
                        <% } else { %>
                            Not running
                        <% } %>
                    </p>
                </div>

                <!-- Servers Count -->
                <div class="bg-gray-800 rounded-lg p-6 border border-gray-700">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-lg font-semibold text-white">Servers</h3>
                        <i class="fas fa-server text-discord-400"></i>
                    </div>
                    <div class="text-2xl font-bold text-white">
                        <%= stats?.guilds || 0 %>
                    </div>
                    <p class="text-gray-400 text-sm">Connected servers</p>
                </div>

                <!-- Users Count -->
                <div class="bg-gray-800 rounded-lg p-6 border border-gray-700">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-lg font-semibold text-white">Users</h3>
                        <i class="fas fa-users text-premium-400"></i>
                    </div>
                    <div class="text-2xl font-bold text-white">
                        <%= stats?.users || 0 %>
                    </div>
                    <p class="text-gray-400 text-sm">Total users reached</p>
                </div>

                <!-- Songs Played -->
                <div class="bg-gray-800 rounded-lg p-6 border border-gray-700">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-lg font-semibold text-white">Songs Played</h3>
                        <i class="fas fa-music text-green-400"></i>
                    </div>
                    <div class="text-2xl font-bold text-white">
                        <%= stats?.songsPlayed || 0 %>
                    </div>
                    <p class="text-gray-400 text-sm">Total songs played</p>
                </div>
            </div>

            <!-- Quick Actions -->
            <div class="bg-gray-800 rounded-lg p-6 border border-gray-700 mb-8">
                <h2 class="text-xl font-semibold text-white mb-6">Quick Actions</h2>
                
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <!-- Bot Control -->
                    <div class="space-y-3">
                        <h3 class="font-semibold text-gray-300">Bot Control</h3>
                        <div class="flex flex-col space-y-2">
                            <% if (botStatus?.status === 'online') { %>
                                <button onclick="controlBot('stop')" class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-md transition-colors duration-200 flex items-center justify-center space-x-2">
                                    <i class="fas fa-stop"></i>
                                    <span>Stop Bot</span>
                                </button>
                                <button onclick="controlBot('restart')" class="bg-yellow-600 hover:bg-yellow-700 text-white px-4 py-2 rounded-md transition-colors duration-200 flex items-center justify-center space-x-2">
                                    <i class="fas fa-redo"></i>
                                    <span>Restart Bot</span>
                                </button>
                            <% } else { %>
                                <button onclick="controlBot('start')" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-md transition-colors duration-200 flex items-center justify-center space-x-2">
                                    <i class="fas fa-play"></i>
                                    <span>Start Bot</span>
                                </button>
                            <% } %>
                        </div>
                    </div>

                    <!-- Quick Settings -->
                    <div class="space-y-3">
                        <h3 class="font-semibold text-gray-300">Quick Settings</h3>
                        <div class="flex flex-col space-y-2">
                            <a href="/dashboard/music" class="bg-discord-600 hover:bg-discord-700 text-white px-4 py-2 rounded-md transition-colors duration-200 flex items-center justify-center space-x-2">
                                <i class="fas fa-music"></i>
                                <span>Music Settings</span>
                            </a>
                            <a href="/dashboard/profile" class="bg-premium-600 hover:bg-premium-700 text-black px-4 py-2 rounded-md transition-colors duration-200 flex items-center justify-center space-x-2">
                                <i class="fas fa-user-edit"></i>
                                <span>Bot Profile</span>
                            </a>
                        </div>
                    </div>

                    <!-- Management -->
                    <div class="space-y-3">
                        <h3 class="font-semibold text-gray-300">Management</h3>
                        <div class="flex flex-col space-y-2">
                            <a href="/dashboard/bot" class="bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-md transition-colors duration-200 flex items-center justify-center space-x-2">
                                <i class="fas fa-robot"></i>
                                <span>Bot Management</span>
                            </a>
                            <a href="/dashboard/subscription" class="bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-md transition-colors duration-200 flex items-center justify-center space-x-2">
                                <i class="fas fa-crown"></i>
                                <span>Subscription</span>
                            </a>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Recent Activity -->
            <div class="bg-gray-800 rounded-lg p-6 border border-gray-700">
                <h2 class="text-xl font-semibold text-white mb-6">Recent Activity</h2>
                
                <div class="space-y-4">
                    <!-- Activity items would go here -->
                    <div class="flex items-center space-x-4 p-4 bg-gray-700 rounded-lg">
                        <div class="w-2 h-2 bg-green-400 rounded-full"></div>
                        <div class="flex-1">
                            <p class="text-white">Bot started successfully</p>
                            <p class="text-gray-400 text-sm">2 hours ago</p>
                        </div>
                    </div>
                    
                    <div class="flex items-center space-x-4 p-4 bg-gray-700 rounded-lg">
                        <div class="w-2 h-2 bg-blue-400 rounded-full"></div>
                        <div class="flex-1">
                            <p class="text-white">Music settings updated</p>
                            <p class="text-gray-400 text-sm">1 day ago</p>
                        </div>
                    </div>
                    
                    <div class="flex items-center space-x-4 p-4 bg-gray-700 rounded-lg">
                        <div class="w-2 h-2 bg-premium-400 rounded-full"></div>
                        <div class="flex-1">
                            <p class="text-white">PremiumPlus activated</p>
                            <p class="text-gray-400 text-sm">3 days ago</p>
                        </div>
                    </div>
                </div>
            </div>
        <% } %>
    </div>
</div>

<!-- Scripts -->
<script>
async function controlBot(action) {
    try {
        const button = event.target.closest('button');
        const originalContent = button.innerHTML;
        button.disabled = true;
        button.innerHTML = '<i class="fas fa-spinner fa-spin"></i> <span>Processing...</span>';

        const response = await fetch(`/api/bot/${action}`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            }
        });

        const data = await response.json();

        if (data.success) {
            showToast(data.message, 'success');
            // Reload page after a short delay
            setTimeout(() => {
                window.location.reload();
            }, 1500);
        } else {
            showToast(data.message || `Failed to ${action} bot`, 'error');
            button.disabled = false;
            button.innerHTML = originalContent;
        }
    } catch (error) {
        console.error('Bot control error:', error);
        showToast(`Failed to ${action} bot`, 'error');
        button.disabled = false;
        button.innerHTML = originalContent;
    }
}

function showToast(message, type = 'info') {
    const toast = document.createElement('div');
    toast.className = `fixed bottom-4 right-4 p-4 rounded-lg shadow-lg z-50 transition-all duration-300 ${
        type === 'success' ? 'bg-green-600' : 
        type === 'error' ? 'bg-red-600' : 
        'bg-blue-600'
    } text-white`;
    toast.textContent = message;
    
    document.body.appendChild(toast);
    
    setTimeout(() => {
        toast.remove();
    }, 5000);
}
</script>

<%- include('../layouts/footer') %>
